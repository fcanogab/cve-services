FROM node:14-alpine3.12

LABEL \
    mitre.name=cveawg \
    mitre.project=cveawg \
    mitre.maintainer=cpaynerogers@mitre.org

WORKDIR /app

COPY package.json /app
RUN npm install
RUN npm install pm2 -g
COPY src /app/src
COPY test /app/test
COPY test-examples /app/test-examples
COPY test-utils /app/test-utils
COPY config /app/config
COPY docker/entrypoint.sh /app/entrypoint.sh
RUN echo '{}' > /app/config/dev.json
RUN echo '{}' > /app/config/test.json

# Change db hostname from localhost to docdb for use inside docker
COPY docker/default.json-docker /app/config/default.json

# CMD npm run start:dev
EXPOSE 3000

ENTRYPOINT '/app/entrypoint.sh'
